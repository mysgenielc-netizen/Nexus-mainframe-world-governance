<div class="fixed bottom-24 right-8 w-[90vw] max-w-lg h-[70vh] max-h-[600px] bg-gray-900/80 backdrop-blur-md rounded-2xl shadow-2xl border border-purple-500/50 flex flex-col z-30">
  <!-- Header -->
  <header class="flex items-center justify-between p-4 border-b border-gray-700">
    <div class="flex items-center gap-3">
      <app-icon name="brain" class="w-6 h-6 text-purple-400"></app-icon>
      <h3 class="font-bold text-lg text-white">Nexus System Interface</h3>
    </div>
    <button (click)="closeChat.emit()" class="text-gray-400 hover:text-white">
      <app-icon name="x" class="w-6 h-6"></app-icon>
    </button>
  </header>

  <!-- Messages -->
  <div #messageContainer class="flex-1 p-4 space-y-4 overflow-y-auto">
    @for (message of messages(); track $index) {
      @switch (message.sender) {
        @case ('user') {
          <div class="flex justify-end">
            <div class="bg-blue-600 text-white p-3 rounded-lg max-w-xs sm:max-w-sm md:max-w-md">
              <p>{{ message.text }}</p>
            </div>
          </div>
        }
        @case ('system') {
          <div class="flex justify-start">
            <div class="bg-gray-700 text-gray-200 p-3 rounded-lg max-w-xs sm:max-w-sm md:max-w-md">
              <p [innerHTML]="message.text.replace(/\\n/g, '<br>')"></p>
            </div>
          </div>
        }
        @case ('log') {
          <div class="text-center text-xs text-purple-400 font-mono flex items-center gap-2">
            <span class="flex-grow border-b border-purple-800/50"></span>
            <span>{{ message.text }}</span>
            <span class="flex-grow border-b border-purple-800/50"></span>
          </div>
        }
      }
    }
    @if(isLoading()) {
      <div class="flex justify-start">
        <div class="bg-gray-700 text-gray-200 p-3 rounded-lg">
          <app-icon name="loader-2" class="w-6 h-6 animate-spin"></app-icon>
        </div>
      </div>
    }
  </div>

  <!-- Input -->
  <footer class="p-4 border-t border-gray-700">
    <form (ngSubmit)="sendMessage()" class="flex items-center gap-2">
      <input 
        type="text" 
        [(ngModel)]="userInput"
        name="userInput"
        placeholder="Message Nexus..."
        [disabled]="isLoading()"
        class="flex-1 bg-gray-800 border border-gray-600 rounded-lg p-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500 disabled:opacity-50"
      >
      <button 
        type="submit" 
        [disabled]="!userInput() || isLoading()" 
        class="bg-purple-600 text-white rounded-lg p-2 disabled:bg-purple-900 disabled:cursor-not-allowed hover:bg-purple-700 transition-colors"
      >
        <app-icon name="send" class="w-6 h-6"></app-icon>
      </button>
    </form>
  </footer>
</div>
